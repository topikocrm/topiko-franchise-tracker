<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Readiness Assessment - Join Topiko Revolution</title>
    <link rel="icon" type="image/png" href="../logo.png">
    
    <!-- External Dependencies -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2.38.0/dist/umd/supabase.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Roboto, sans-serif;
            background: #000;
            min-height: 100vh;
            color: white;
            overflow: hidden;
            position: relative;
        }

        /* Poppins font for Topiko brand name */
        .topiko-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            position: relative;
            filter: drop-shadow(0 0 12px rgba(102, 126, 234, 0.3)) 
                    drop-shadow(0 0 24px rgba(118, 75, 162, 0.2));
            animation: subtleGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes subtleGlow {
            0% {
                filter: drop-shadow(0 0 12px rgba(102, 126, 234, 0.3)) 
                        drop-shadow(0 0 24px rgba(118, 75, 162, 0.2));
            }
            100% {
                filter: drop-shadow(0 0 16px rgba(102, 126, 234, 0.4)) 
                        drop-shadow(0 0 32px rgba(118, 75, 162, 0.3));
            }
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            opacity: 0;
            transform: scale(1) translateY(0);
            transition: opacity 0.5s ease-in-out;
            z-index: 1;
            pointer-events: none;
            overflow-y: auto;
        }

        .screen.active {
            opacity: 1;
            transform: scale(1) translateY(0);
            z-index: 2;
            pointer-events: all;
        }

        .container {
            max-width: 900px;
            width: 100%;
            text-align: center;
            margin: auto;
            min-height: min-content;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(40px);
            border-radius: 32px;
            padding: 4rem 3rem;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 600;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        .brand-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        /* Progress Indicator */
        .progress-container {
            position: fixed;
            top: 1rem;
            left: 1rem;
            right: 1rem;
            z-index: 100;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 0.5rem 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .progress-text {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .progress-steps {
            display: flex;
            gap: 0.5rem;
        }

        .progress-step {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 0 12px rgba(102, 126, 234, 0.5);
        }

        .progress-step.completed {
            background: #10b981;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 2rem;
            text-align: left;
        }

        .form-label {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            font-size: 1rem;
            color: white;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }

        .question-text {
            font-size: 1.8rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.3;
            margin-bottom: 2rem;
            text-align: center;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.5), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .option-card:hover::before {
            transform: translateX(0);
        }

        .option-card:hover {
            border-color: rgba(102, 126, 234, 0.3);
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .option-card.selected {
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
        }

        .option-card input[type="radio"],
        .option-card input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .option-card label {
            display: flex;
            align-items: flex-start;
            cursor: pointer;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
            font-size: 1rem;
        }

        .option-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
            margin-top: 0.1rem;
            flex-shrink: 0;
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            font-family: inherit;
            position: relative;
            overflow: hidden;
            min-height: 56px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover:not(:disabled) {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        .btn-group .btn {
            min-width: 140px;
        }

        /* Chat Bubbles */
        .chat-container {
            margin-bottom: 2rem;
            text-align: center;
        }

        .chat-bubble {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.5rem 2rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: inline-block;
            max-width: 80%;
            animation: bubbleSlideIn 0.6s ease-out;
        }

        @keyframes bubbleSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .chat-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            line-height: 1.6;
            font-weight: 400;
        }

        /* Loading Animation */
        .loading-dots {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
        }

        .loading-dot {
            width: 6px;
            height: 6px;
            background: currentColor;
            border-radius: 50%;
            animation: loadingBounce 1.4s ease-in-out infinite both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        .loading-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes loadingBounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Results Display */
        .results-container {
            text-align: center;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 2rem;
            position: relative;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 50%;
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 0 40px rgba(102, 126, 234, 0.2);
        }

        .score-number {
            font-size: 3rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .score-label {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .personalized-story {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .story-text {
            font-size: 1.1rem;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                overflow-y: auto;
            }
            
            .screen {
                position: relative;
                height: auto;
                min-height: 100vh;
                padding: 1rem;
            }
            
            .container {
                max-width: 100%;
                padding: 0;
            }
            
            .glass-card {
                padding: 2rem 1.5rem;
                border-radius: 24px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .question-text {
                font-size: 1.4rem;
            }
            
            .btn-group {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn {
                width: 100%;
            }
            
            .progress-container {
                position: relative;
                margin-bottom: 1rem;
            }
            
            .score-circle {
                width: 160px;
                height: 160px;
            }
            
            .score-number {
                font-size: 2.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .glass-card {
                padding: 1.5rem 1rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .option-card {
                padding: 1rem;
            }
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Utility Classes */
        .hidden { display: none; }
        .text-center { text-align: center; }
        .mb-2 { margin-bottom: 2rem; }
        
        /* ===== PROFILE PREVIEW SYSTEM ===== */
        
        /* Main Layout - Desktop Grid */
        .main-layout {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            min-height: 100vh;
        }
        
        @media (min-width: 1600px) {
            .main-layout {
                max-width: 1600px;
                gap: 3rem;
                padding: 0 3rem;
            }
        }
        
        .content-area {
            min-height: 100vh;
            width: 100%;
            max-width: none;
        }
        
        .content-area .container {
            max-width: 800px;
            padding: 2rem;
            margin: 0;
        }
        
        .content-area .glass-card {
            max-width: 100%;
        }
        
        /* Right Profile Panel - Desktop Only */
        .profile-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 1.5rem;
            position: sticky;
            top: 2rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
            width: 100%;
            min-width: 280px;
            max-width: 320px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .profile-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
            color: white;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }
        
        .profile-status {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .profile-section {
            margin-bottom: 1.5rem;
        }
        
        .profile-section h3 {
            font-size: 1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 0.5rem;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }
        
        .detail-value {
            font-size: 0.9rem;
            color: white;
            font-weight: 500;
            text-align: right;
            max-width: 60%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .goals-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .goal-tag {
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }
        
        .progress-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }
        
        .progress-value {
            color: white;
            font-weight: 600;
        }
        
        .mini-score {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
        }
        
        .mini-score-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.25rem;
        }
        
        .mini-score-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }
        
        /* Mobile Profile Float Widget */
        .mobile-profile-float {
            display: none !important;
            position: fixed;
            top: 1rem;
            left: 1rem;
            right: 6rem;
            z-index: 100;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mobile-profile-float.show {
            display: block !important;
            visibility: visible;
            opacity: 1;
        }
        
        .float-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .float-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
            color: white;
        }
        
        .float-info {
            flex: 1;
            min-width: 0;
        }
        
        .float-name {
            font-size: 0.95rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.1rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .float-status {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Mobile Profile Bottom Sheet */
        .mobile-profile-sheet {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(40px);
            border-radius: 32px 32px 0 0;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mobile-profile-sheet.active {
            transform: translateY(0);
        }
        
        .sheet-handle {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 1rem auto;
            cursor: pointer;
        }
        
        .sheet-content {
            padding: 0 1.5rem 2rem;
        }
        
        .sheet-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .sheet-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
            color: white;
        }
        
        .sheet-info {
            flex: 1;
        }
        
        .sheet-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }
        
        .sheet-status {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .mobile-details-grid {
            display: grid;
            gap: 1rem;
        }
        
        .mobile-detail {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .mobile-detail-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        
        .mobile-detail-value {
            font-size: 0.95rem;
            color: white;
            font-weight: 600;
        }
        
        /* Responsive Breakpoints */
        @media (max-width: 1400px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 0;
                padding: 0 1rem;
            }
            
            .profile-panel {
                display: none;
            }
            
            .content-area .container {
                max-width: 800px;
                margin: 0 auto;
                padding: 2rem;
            }
            
            .mobile-profile-float.show {
                display: block !important;
            }
        }
        
        /* Tablet Landscape */
        @media (max-width: 896px) and (orientation: landscape) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 0;
                padding: 0;
            }
            
            .profile-panel {
                display: none;
            }
            
            .mobile-profile-float.show {
                display: block !important;
            }
        }
        
        /* Mobile Portrait */
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 0;
                padding: 0;
                min-height: auto;
            }
            
            .profile-panel {
                display: none;
            }
            
            .content-area {
                min-height: auto;
            }
            
            .content-area .container {
                padding: 1rem;
                margin: 0;
                max-width: 100%;
            }
            
            .glass-card {
                padding: 1.5rem;
                margin: 0;
            }
            
            .mobile-profile-float.show {
                display: block !important;
                top: 0.5rem;
                left: 0.5rem;
                right: 4rem;
                padding: 0.75rem 1rem;
            }
            
            .mobile-profile-sheet {
                display: block;
            }
            
            /* Reduce overall page height on mobile */
            body {
                overflow-x: hidden;
            }
            
            .screen {
                min-height: calc(100vh - 4rem);
                display: flex;
                align-items: center;
            }
            
            .screen.active {
                min-height: auto;
            }
            
            /* Reduce vertical spacing on mobile */
            h1 {
                font-size: 2rem;
                margin-bottom: 1rem;
            }
            
            .subtitle {
                margin-bottom: 1.5rem;
            }
            
            .form-group {
                margin-bottom: 1.5rem;
            }
            
            .btn-group {
                margin-top: 1.5rem;
                gap: 1rem;
            }
            
            .chat-container {
                margin: 1rem 0;
            }
        }
    </style>
</head>
<body>
    <!-- Progress Indicator -->
    <div class="progress-container">
        <div class="progress-text" id="progressText">Step 1 of 4</div>
        <div class="progress-steps">
            <div class="progress-step active"></div>
            <div class="progress-step"></div>
            <div class="progress-step"></div>
            <div class="progress-step"></div>
        </div>
    </div>

    <!-- Mobile Profile Float Widget -->
    <div class="mobile-profile-float" id="mobile-float" style="display: none;">
        <div class="float-content">
            <div class="float-avatar" id="float-avatar">?</div>
            <div class="float-info">
                <div class="float-name" id="float-name">Building your profile...</div>
                <div class="float-status" id="float-status">Answer questions to get started</div>
            </div>
        </div>
    </div>

    <div class="main-layout">
        <!-- Left Content Area -->
        <div class="content-area">
            <!-- Screen 1: Welcome -->
            <div id="screen1" class="screen active">
                <div class="container">
                <div class="glass-card">
                    <h1>Discover Your <span class="topiko-text brand-highlight">Digital Readiness</span></h1>
                    <p class="subtitle">
                        Get your personalized business assessment and discover the perfect digital solution for your growth in just 3 minutes.
                    </p>
                    
                    <div class="chat-container">
                        <div class="chat-bubble">
                            <div class="chat-text">
                                👋 Hi! I'm excited to help you discover your business's digital potential. Let's start with your details.
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="fullName">What's your full name?</label>
                        <input 
                            type="text" 
                            id="fullName" 
                            class="form-input" 
                            placeholder="Enter your full name"
                            required
                        >
                    </div>

                    <div class="form-group" id="businessNameGroup" style="display: none;">
                        <label class="form-label" for="businessName">What's your business name?</label>
                        <input 
                            type="text" 
                            id="businessName" 
                            class="form-input" 
                            placeholder="Your business name"
                            required
                        >
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" id="continueBtn1" disabled>
                            Continue to Assessment
                            <span class="loading-dots" id="loading1" style="display: none;">
                                <span class="loading-dot"></span>
                                <span class="loading-dot"></span>
                                <span class="loading-dot"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen 2: Business Assessment -->
        <div id="screen2" class="screen">
            <div class="container">
                <div class="glass-card">
                    <div class="question-text" id="currentQuestion">
                        What type of business do you run?
                    </div>
                    
                    <div class="chat-container" id="chatContainer2"></div>

                    <div id="questionContainer">
                        <!-- Questions will be dynamically loaded here -->
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" id="backBtn2">
                            ← Back
                        </button>
                        <button type="button" class="btn btn-primary" id="nextQuestion" disabled>
                            Next Question
                            <span class="loading-dots" id="loading2" style="display: none;">
                                <span class="loading-dot"></span>
                                <span class="loading-dot"></span>
                                <span class="loading-dot"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen 3: Contact & Verification -->
        <div id="screen3" class="screen">
            <div class="container">
                <div class="glass-card">
                    <h1>Almost Ready! 🎉</h1>
                    <p class="subtitle">
                        We've prepared your personalized <span class="brand-highlight">Digital Readiness Report</span>. 
                        Please verify your contact details to receive your results.
                    </p>
                    
                    <div class="chat-container">
                        <div class="chat-bubble">
                            <div class="chat-text">
                                📱 Just need your mobile number to send your private assessment results securely — no spam, ever!
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mobile">Mobile Number</label>
                        <input 
                            type="tel" 
                            id="mobile" 
                            class="form-input" 
                            placeholder="+91 98765 43210"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="location">Your City</label>
                        <input 
                            type="text" 
                            id="location" 
                            class="form-input" 
                            placeholder="City, State"
                            required
                        >
                    </div>

                    <div class="form-group" id="otpGroup" style="display: none;">
                        <label class="form-label" for="otp">Verification Code</label>
                        <input 
                            type="text" 
                            id="otp" 
                            class="form-input" 
                            placeholder="Enter 4-digit OTP"
                            maxlength="4"
                            required
                        >
                        <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 0.5rem; text-align: center;">
                            Demo Mode: Use <strong>1111</strong> as OTP
                        </p>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" id="backBtn3">
                            ← Back
                        </button>
                        <button type="button" class="btn btn-primary" id="sendOtpBtn">
                            Send OTP
                            <span class="loading-dots" id="loading3" style="display: none;">
                                <span class="loading-dot"></span>
                                <span class="loading-dot"></span>
                                <span class="loading-dot"></span>
                            </span>
                        </button>
                        <button type="button" class="btn btn-primary" id="verifyBtn" style="display: none;">
                            View My Results 🎯
                            <span class="loading-dots" id="loading4" style="display: none;">
                                <span class="loading-dot"></span>
                                <span class="loading-dot"></span>
                                <span class="loading-dot"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen 4: Results -->
        <div id="screen4" class="screen">
            <div class="container">
                <div class="glass-card results-container">
                    <h1 id="resultsTitle">🎉 Great work, <span id="userName">[Name]</span>!</h1>
                    <p class="subtitle">Here's your personalized <span class="brand-highlight topiko-text">Digital Readiness</span> summary</p>
                    
                    <div class="personalized-story">
                        <div class="story-text" id="personalizedStory">
                            <!-- Dynamic story will be generated here -->
                        </div>
                    </div>

                    <div class="score-circle">
                        <div class="score-number" id="scoreNumber">0</div>
                        <div class="score-label">Digital Readiness Score</div>
                    </div>

                    <div class="glass-card mb-2">
                        <div style="padding: 2rem; text-align: left;">
                            <h3 style="color: white; margin-bottom: 1.5rem; font-size: 1.3rem; text-align: center;">
                                📊 Your Score Breakdown
                            </h3>
                            <div id="scoreBreakdown">
                                <!-- Score dimensions will be added here -->
                            </div>
                        </div>
                    </div>

                    <div class="glass-card mb-2">
                        <div style="padding: 2rem; text-align: center;">
                            <h3 style="color: white; margin-bottom: 1.5rem; font-size: 1.3rem;">
                                🎯 Perfect Solution for You
                            </h3>
                            <div id="recommendedProduct">
                                <!-- Product recommendation will be added here -->
                            </div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" id="viewPlanBtn">
                            📊 Get My Detailed Plan
                        </button>
                        <button type="button" class="btn btn-secondary" id="consultationBtn">
                            📞 Book Free Consultation
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Right Profile Panel (Desktop Only) -->
        <div class="profile-panel" id="profile-panel">
            <div class="profile-header">
                <div class="profile-avatar" id="profile-avatar">?</div>
                <div class="profile-info">
                    <div class="profile-name" id="profile-name">Building your profile...</div>
                    <div class="profile-status" id="profile-status">Answer questions to get started</div>
                </div>
            </div>
            
            <div class="profile-content" id="profile-content">
                <div class="profile-section" id="business-details" style="display: none;">
                    <h3>📊 Business Overview</h3>
                    <div class="detail-item">
                        <span class="detail-label">Business:</span>
                        <span class="detail-value" id="business-name-display">—</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Type:</span>
                        <span class="detail-value" id="business-type-display">—</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Location:</span>
                        <span class="detail-value" id="location-display">—</span>
                    </div>
                </div>
                
                <div class="profile-section" id="goals-section" style="display: none;">
                    <h3>🎯 Your Goals</h3>
                    <div id="goals-display" class="goals-grid">
                        <!-- Goals will be added dynamically -->
                    </div>
                </div>
                
                <div class="profile-section" id="assessment-section" style="display: none;">
                    <h3>🔍 Assessment Status</h3>
                    <div class="progress-item">
                        <span class="progress-label">Digital Status:</span>
                        <span class="progress-value" id="digital-status-display">—</span>
                    </div>
                    <div class="progress-item">
                        <span class="progress-label">Budget:</span>
                        <span class="progress-value" id="budget-display">—</span>
                    </div>
                    <div class="progress-item">
                        <span class="progress-label">Challenge:</span>
                        <span class="progress-value" id="challenge-display">—</span>
                    </div>
                </div>
                
                <div class="profile-section" id="score-preview" style="display: none;">
                    <h3>⚡ Quick Preview</h3>
                    <div class="mini-score">
                        <div class="mini-score-number" id="mini-score">0</div>
                        <div class="mini-score-label">Readiness Score</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Profile Bottom Sheet -->
    <div class="mobile-profile-sheet" id="mobile-sheet" style="display: none;">
        <div class="sheet-handle" onclick="toggleMobileProfile()"></div>
        <div class="sheet-content">
            <div class="sheet-header">
                <div class="sheet-avatar" id="sheet-avatar">?</div>
                <div class="sheet-info">
                    <div class="sheet-name" id="sheet-name">Building your profile...</div>
                    <div class="sheet-status" id="sheet-status">Answer questions to get started</div>
                </div>
            </div>
            <div class="sheet-body">
                <div id="mobile-business-details" style="display: none;">
                    <h3>📊 Business Overview</h3>
                    <div class="mobile-details-grid">
                        <div class="mobile-detail">
                            <div class="mobile-detail-label">Business</div>
                            <div class="mobile-detail-value" id="mobile-business-name">—</div>
                        </div>
                        <div class="mobile-detail">
                            <div class="mobile-detail-label">Type</div>
                            <div class="mobile-detail-value" id="mobile-business-type">—</div>
                        </div>
                        <div class="mobile-detail">
                            <div class="mobile-detail-label">Location</div>
                            <div class="mobile-detail-value" id="mobile-location">—</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentScreen = 1;
        let currentQuestionIndex = 0;
        let answers = {};
        let formData = {
            fullName: '',
            businessName: '',
            businessType: '',
            location: '',
            mobile: '',
            sessionId: generateSessionId(),
            browserInfo: getBrowserInfo(),
            startTime: new Date().toISOString(),
            campaignSource: 'digital_readiness'
        };
        let supabase;
        let leadId = null;

        // Assessment Questions
        const questions = [
            {
                id: 'businessType',
                question: 'What type of business do you run?',
                type: 'radio',
                options: [
                    { value: 'retail', label: 'Retail / E-commerce', description: 'Sell products online or offline', icon: '🛍️' },
                    { value: 'services', label: 'Professional Services', description: 'Consultancy, legal, medical, etc.', icon: '💼' },
                    { value: 'manufacturing', label: 'Manufacturing', description: 'Production and distribution', icon: '🏭' },
                    { value: 'others', label: 'Other Industry', description: 'Something unique', icon: '🏢' }
                ]
            },
            {
                id: 'goals',
                question: 'What would you like to achieve? (Select all that apply)',
                type: 'checkbox',
                options: [
                    { value: 'more_customers', label: 'Get more customers', icon: '📈' },
                    { value: 'showcase', label: 'Showcase products/services online', icon: '🌐' },
                    { value: 'brand', label: 'Build professional brand identity', icon: '✨' },
                    { value: 'automate', label: 'Automate orders & customer management', icon: '🤖' },
                    { value: 'app', label: 'Create branded app/website', icon: '📱' }
                ]
            },
            {
                id: 'digitalStatus', 
                question: "What's your current digital status?",
                type: 'radio',
                options: [
                    { value: 'no_presence', label: 'No digital presence yet', icon: '🌱' },
                    { value: 'basic_social', label: 'Only on WhatsApp / Google', icon: '💬' },
                    { value: 'basic_website', label: 'Have a basic website or page', icon: '🌐' },
                    { value: 'no_results', label: 'Already digital, not getting results', icon: '📉' }
                ]
            },
            {
                id: 'budget',
                question: "What's your monthly digital budget?",
                type: 'radio', 
                options: [
                    { value: 'below_2k', label: 'Below ₹2,000', icon: '💰' },
                    { value: '2k_10k', label: '₹2,000 - ₹10,000', icon: '💳' },
                    { value: '10k_25k', label: '₹10,000 - ₹25,000', icon: '💎' },
                    { value: '25k_plus', label: '₹25,000+', icon: '🚀' }
                ]
            },
            {
                id: 'challenge',
                question: "What's your biggest challenge right now?",
                type: 'radio',
                options: [
                    { value: 'no_leads', label: 'Not getting leads', icon: '📢' },
                    { value: 'dont_know', label: "Don't know where to start", icon: '❓' },
                    { value: 'no_time', label: 'No time to manage digital presence', icon: '⏰' },
                    { value: 'low_sales', label: 'Low sales despite being online', icon: '📊' }
                ]
            }
        ];

        // Utility functions
        function generateSessionId() {
            return 'dr_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        }

        function getBrowserInfo() {
            return {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                viewport: {
                    width: window.innerWidth,
                    height: window.innerHeight
                },
                timestamp: new Date().toISOString()
            };
        }

        // ===== PROFILE PREVIEW SYSTEM =====
        
        function updateProfilePreview() {
            const firstName = formData.fullName.split(' ')[0] || '';
            const avatar = firstName.charAt(0).toUpperCase() || '?';
            
            // Update all avatar elements
            const avatarElements = document.querySelectorAll('.profile-avatar, .float-avatar, .sheet-avatar');
            avatarElements.forEach(el => el.textContent = avatar);
            
            // Update name displays
            const desktopName = `${firstName}${formData.location ? ' from ' + formData.location : ''}`;
            const mobileName = firstName ? `Building profile for ${firstName}` : 'Building your profile...';
            
            // Desktop profile panel
            const profileName = document.getElementById('profile-name');
            const profileStatus = document.getElementById('profile-status');
            if (profileName) profileName.textContent = desktopName || 'Building your profile...';
            if (profileStatus) profileStatus.textContent = getProfileStatus();
            
            // Mobile float widget
            const floatName = document.getElementById('float-name');
            const floatStatus = document.getElementById('float-status');
            if (floatName) floatName.textContent = desktopName || 'Building your profile...';
            if (floatStatus) floatStatus.textContent = getProfileStatus();
            
            // Mobile bottom sheet
            const sheetName = document.getElementById('sheet-name');
            const sheetStatus = document.getElementById('sheet-status');
            if (sheetName) sheetName.textContent = mobileName;
            if (sheetStatus) sheetStatus.textContent = getProfileStatus();
            
            // Show mobile float widget after name is entered (on mobile/tablet)
            if (firstName && window.innerWidth <= 1400) {
                showMobileFloat();
            }
            
            // Update business details section
            updateBusinessDetails();
            
            // Update goals section
            updateGoalsSection();
            
            // Update assessment section
            updateAssessmentSection();
        }
        
        function getProfileStatus() {
            if (currentScreen === 1) return 'Collecting basic information...';
            if (currentScreen === 2) return 'Understanding your business goals...';
            if (currentScreen === 3) return 'Preparing your assessment results...';
            if (currentScreen === 4) return 'Digital readiness assessment complete!';
            return 'Answer questions to get started';
        }
        
        function updateBusinessDetails() {
            const businessSection = document.getElementById('business-details');
            const mobileBusinessSection = document.getElementById('mobile-business-details');
            
            if (formData.businessName || formData.businessType || formData.location) {
                // Desktop
                if (businessSection) {
                    businessSection.style.display = 'block';
                    
                    const businessNameDisplay = document.getElementById('business-name-display');
                    const businessTypeDisplay = document.getElementById('business-type-display');
                    const locationDisplay = document.getElementById('location-display');
                    
                    if (businessNameDisplay) businessNameDisplay.textContent = formData.businessName || '—';
                    if (businessTypeDisplay) businessTypeDisplay.textContent = getBusinessTypeLabel(formData.businessType) || '—';
                    if (locationDisplay) locationDisplay.textContent = formData.location || '—';
                }
                
                // Mobile
                if (mobileBusinessSection) {
                    mobileBusinessSection.style.display = 'block';
                    
                    const mobileBusinessName = document.getElementById('mobile-business-name');
                    const mobileBusinessType = document.getElementById('mobile-business-type');
                    const mobileLocation = document.getElementById('mobile-location');
                    
                    if (mobileBusinessName) mobileBusinessName.textContent = formData.businessName || '—';
                    if (mobileBusinessType) mobileBusinessType.textContent = getBusinessTypeLabel(formData.businessType) || '—';
                    if (mobileLocation) mobileLocation.textContent = formData.location || '—';
                }
            }
        }
        
        function getBusinessTypeLabel(type) {
            const labels = {
                'retail': 'Retail / E-commerce',
                'services': 'Professional Services',
                'manufacturing': 'Manufacturing',
                'others': 'Other Industry'
            };
            return labels[type] || type;
        }
        
        function updateGoalsSection() {
            const goalsSection = document.getElementById('goals-section');
            const goalsDisplay = document.getElementById('goals-display');
            
            if (answers.goals && answers.goals.length > 0) {
                if (goalsSection) goalsSection.style.display = 'block';
                if (goalsDisplay) {
                    goalsDisplay.innerHTML = '';
                    answers.goals.forEach(goal => {
                        const goalTag = document.createElement('span');
                        goalTag.className = 'goal-tag';
                        goalTag.textContent = getGoalLabel(goal);
                        goalsDisplay.appendChild(goalTag);
                    });
                }
            }
        }
        
        function getGoalLabel(goal) {
            const labels = {
                'more_customers': 'Get more customers',
                'showcase': 'Showcase products/services',
                'brand': 'Build professional brand',
                'automate': 'Automate processes',
                'app': 'Create branded app/website'
            };
            return labels[goal] || goal;
        }
        
        function updateAssessmentSection() {
            const assessmentSection = document.getElementById('assessment-section');
            
            if (answers.digitalStatus || answers.budget || answers.challenge) {
                if (assessmentSection) {
                    assessmentSection.style.display = 'block';
                    
                    const digitalStatusDisplay = document.getElementById('digital-status-display');
                    const budgetDisplay = document.getElementById('budget-display');
                    const challengeDisplay = document.getElementById('challenge-display');
                    
                    if (digitalStatusDisplay) digitalStatusDisplay.textContent = getDigitalStatusLabel(answers.digitalStatus) || '—';
                    if (budgetDisplay) budgetDisplay.textContent = getBudgetLabel(answers.budget) || '—';
                    if (challengeDisplay) challengeDisplay.textContent = getChallengeLabel(answers.challenge) || '—';
                }
            }
        }
        
        function getDigitalStatusLabel(status) {
            const labels = {
                'no_presence': 'No digital presence yet',
                'basic_social': 'Only on WhatsApp/Google',
                'basic_website': 'Have basic website',
                'no_results': 'Digital but no results'
            };
            return labels[status] || status;
        }
        
        function getBudgetLabel(budget) {
            const labels = {
                'below_2k': 'Below ₹2,000',
                '2k_10k': '₹2,000-₹10,000',
                '10k_25k': '₹10,000-₹25,000',
                '25k_plus': '₹25,000+'
            };
            return labels[budget] || budget;
        }
        
        function getChallengeLabel(challenge) {
            const labels = {
                'no_leads': 'Not getting leads',
                'dont_know': "Don't know where to start",
                'no_time': 'No time to manage',
                'low_sales': 'Low sales despite being online'
            };
            return labels[challenge] || challenge;
        }
        
        function showMobileFloat() {
            const mobileFloat = document.getElementById('mobile-float');
            if (mobileFloat && window.innerWidth <= 1400) {
                mobileFloat.classList.add('show');
                
                // Add click handler to show bottom sheet
                mobileFloat.onclick = toggleMobileProfile;
            }
        }
        
        function toggleMobileProfile() {
            const mobileSheet = document.getElementById('mobile-sheet');
            if (mobileSheet) {
                mobileSheet.classList.toggle('active');
            }
        }
        
        // Handle responsive behavior
        function handleResize() {
            const mobileFloat = document.getElementById('mobile-float');
            const mobileSheet = document.getElementById('mobile-sheet');
            
            if (window.innerWidth > 1400) {
                // Desktop - hide mobile elements
                if (mobileFloat) mobileFloat.classList.remove('show');
                if (mobileSheet) mobileSheet.classList.remove('active');
            } else if (formData.fullName) {
                // Mobile/Tablet with data - show float widget
                showMobileFloat();
            }
        }
        
        // Initialize responsive handler
        window.addEventListener('resize', handleResize);
        
        // ===== INTERACTIVE CHAT MESSAGES =====
        
        let lastMessage = '';
        
        function addChatMessage(message, delay = 500) {
            const chatContainer = document.querySelector('.chat-container');
            if (!chatContainer || message === lastMessage) return;
            
            lastMessage = message;
            
            setTimeout(() => {
                const chatBubble = document.createElement('div');
                chatBubble.className = 'chat-bubble';
                chatBubble.innerHTML = `<div class="chat-text">${message}</div>`;
                
                // Add animation
                chatBubble.style.opacity = '0';
                chatBubble.style.transform = 'translateY(20px)';
                chatContainer.appendChild(chatBubble);
                
                // Animate in
                setTimeout(() => {
                    chatBubble.style.transition = 'all 0.5s ease';
                    chatBubble.style.opacity = '1';
                    chatBubble.style.transform = 'translateY(0)';
                }, 50);
            }, delay);
        }
        
        function clearChatMessages() {
            const chatContainer = document.querySelector('.chat-container');
            if (chatContainer) {
                // Keep only the first (original) message
                const messages = chatContainer.querySelectorAll('.chat-bubble');
                for (let i = 1; i < messages.length; i++) {
                    messages[i].remove();
                }
                lastMessage = ''; // Reset to allow new messages
            }
        }

        function updateProgress() {
            const progressText = document.getElementById('progressText');
            const progressSteps = document.querySelectorAll('.progress-step');
            
            if (progressText) {
                progressText.textContent = `Step ${currentScreen} of 4`;
            }
            
            progressSteps.forEach((step, index) => {
                if (index < currentScreen - 1) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index === currentScreen - 1) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        // Initialize Supabase
        function initializeSupabase() {
            try {
                const SUPABASE_URL = 'https://uyaubwfmxmxelcshuyaf.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5YXVid2ZteG14ZWxjc2h1eWFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDA0MTksImV4cCI6MjA2OTUxNjQxOX0.Sc9qUUXr73x8yw5-2rs-pcI03lFpMTSyuhW9RDLcOLI';
                
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('Digital Readiness: Supabase initialized successfully');
                return true;
            } catch (error) {
                console.error('Digital Readiness: Supabase initialization failed:', error);
                return false;
            }
        }

        // Screen transitions
        function showScreen(screenNumber, direction = 'forward') {
            const currentScreenEl = document.querySelector('.screen.active');
            const newScreenEl = document.getElementById(`screen${screenNumber}`);
            
            if (!newScreenEl) return;
            
            // Simple transition
            if (currentScreenEl && currentScreenEl !== newScreenEl) {
                currentScreenEl.classList.remove('active');
            }
            
            newScreenEl.classList.add('active');
            currentScreen = screenNumber;
            updateProgress();
            updateProfilePreview(); // Update profile preview on screen change
            
            // Clear chat messages when changing screens (except screen 1)
            if (screenNumber > 1) {
                clearChatMessages();
            }
        }

        // Screen 1: Welcome and Basic Info
        function initScreen1() {
            const fullNameInput = document.getElementById('fullName');
            const businessNameInput = document.getElementById('businessName');
            const continueBtn = document.getElementById('continueBtn1');
            let step = 0;

            fullNameInput.addEventListener('input', (e) => {
                const value = e.target.value.trim();
                if (value.length > 2) {
                    formData.fullName = value;
                    updateProfilePreview(); // Update profile preview
                    
                    // Add interactive greeting message
                    const firstName = value.split(' ')[0];
                    addChatMessage(`Nice to meet you, ${firstName}.`);
                    
                    if (step === 0) {
                        setTimeout(() => showBusinessNameField(), 1000);
                        step = 1;
                    }
                    updateContinueButton();
                } else {
                    continueBtn.disabled = true;
                }
            });

            businessNameInput.addEventListener('input', (e) => {
                const value = e.target.value.trim();
                formData.businessName = value;
                updateProfilePreview(); // Update profile preview
                
                // Add interactive greeting message for business name
                if (value.length > 2) {
                    addChatMessage(`Sounds great — ${value}. Let's get to know your business better.`);
                }
                
                updateContinueButton();
            });

            function showBusinessNameField() {
                const businessGroup = document.getElementById('businessNameGroup');
                businessGroup.style.display = 'block';
                businessNameInput.focus();
            }

            function updateContinueButton() {
                const hasName = formData.fullName.length > 2;
                const hasBusiness = formData.businessName.length > 1;
                continueBtn.disabled = !(hasName && hasBusiness);
            }

            continueBtn.addEventListener('click', async () => {
                showLoadingState('loading1', true);
                await saveFormData('contact_details');
                showLoadingState('loading1', false);
                showScreen(2);
            });
        }

        // Screen 2: Assessment Questions
        function initScreen2() {
            const backBtn = document.getElementById('backBtn2');
            const nextBtn = document.getElementById('nextQuestion');
            
            currentQuestionIndex = 0;
            showCurrentQuestion();

            backBtn.addEventListener('click', () => {
                showScreen(1, 'backward');
            });

            nextBtn.addEventListener('click', () => {
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    showCurrentQuestion();
                } else {
                    saveAnswers();
                    
                    // Add final engagement message before moving to Screen 3
                    const firstName = formData.fullName.split(' ')[0] || 'there';
                    addChatMessage(`Thanks, ${firstName}! You've almost completed your Digital Checkup — let's get your personalized preview.`, 1000);
                    
                    setTimeout(() => {
                        showScreen(3);
                    }, 2000);
                }
            });
        }

        function showCurrentQuestion() {
            const question = questions[currentQuestionIndex];
            const questionText = document.getElementById('currentQuestion');
            const container = document.getElementById('questionContainer');
            const nextBtn = document.getElementById('nextQuestion');
            
            if (questionText) {
                questionText.textContent = question.question;
            }
            
            // Create options HTML
            const optionsHTML = question.options.map(option => `
                <div class="option-card">
                    <input type="${question.type}" id="${option.value}" name="${question.id}" value="${option.value}">
                    <label for="${option.value}">
                        <span class="option-icon">${option.icon}</span>
                        <div>
                            <strong>${option.label}</strong>
                            ${option.description ? `<div style="font-size: 0.9rem; opacity: 0.8; margin-top: 0.3rem;">${option.description}</div>` : ''}
                        </div>
                    </label>
                </div>
            `).join('');
            
            container.innerHTML = `
                <div class="form-group">
                    <div class="options-grid">
                        ${optionsHTML}
                    </div>
                </div>
            `;
            
            // Add event listeners
            const inputs = container.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('change', () => {
                    updateSelection(question.id, question.type);
                    updateNextButton();
                });
                
                input.closest('.option-card').addEventListener('click', () => {
                    if (question.type === 'radio') {
                        container.querySelectorAll('.option-card').forEach(card => {
                            card.classList.remove('selected');
                        });
                    }
                    if (input.checked || input.type === 'radio') {
                        input.closest('.option-card').classList.add('selected');
                    } else {
                        input.closest('.option-card').classList.remove('selected');
                    }
                });
            });
            
            updateNextButton();
        }

        function updateSelection(questionId, type) {
            const inputs = document.querySelectorAll(`input[name="${questionId}"]:checked`);
            
            if (type === 'checkbox') {
                answers[questionId] = Array.from(inputs).map(input => input.value);
            } else {
                answers[questionId] = inputs.length > 0 ? inputs[0].value : null;
            }
            
            // Update business type in formData for profile preview
            if (questionId === 'businessType') {
                formData.businessType = answers[questionId];
                
                // Add interactive message for business type
                const businessTypeLabels = {
                    'retail': 'Retail/E-commerce',
                    'services': 'Professional Services', 
                    'manufacturing': 'Manufacturing',
                    'others': 'Other Industry'
                };
                const typeLabel = businessTypeLabels[answers[questionId]] || answers[questionId];
                addChatMessage(`Got it, ${typeLabel} businesses are going digital faster than ever!`);
            }
            
            // Add interactive messages for Screen 2 questions
            if (questionId === 'goals' && answers[questionId] && answers[questionId].length > 0) {
                addChatMessage("Got it. Everyone's growth goals are unique — we'll tailor the plan just for you.");
            }
            
            if (questionId === 'digitalStatus' && answers[questionId]) {
                addChatMessage("Makes sense. Many businesses start here — we'll help you go beyond visibility.");
            }
            
            if (questionId === 'budget' && answers[questionId]) {
                addChatMessage("Perfect. That helps us suggest the most effective plan for your scale.");
            }
            
            if (questionId === 'challenge' && answers[questionId]) {
                addChatMessage("We hear this a lot — you're not alone, and that's exactly what this checkup solves.");
            }
            
            // Update profile preview whenever an answer is selected
            updateProfilePreview();
        }

        function updateNextButton() {
            const question = questions[currentQuestionIndex];
            const nextBtn = document.getElementById('nextQuestion');
            
            if (!nextBtn) return;
            
            const hasAnswer = answers[question.id] && 
                (Array.isArray(answers[question.id]) ? answers[question.id].length > 0 : answers[question.id]);
            
            nextBtn.disabled = !hasAnswer;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.innerHTML = `
                    Get My Results! 🎯
                    <span class="loading-dots" id="loading2" style="display: none;">
                        <span class="loading-dot"></span>
                        <span class="loading-dot"></span>
                        <span class="loading-dot"></span>
                    </span>
                `;
            }
        }

        async function saveAnswers() {
            Object.assign(formData, answers);
            await saveFormData('assessment_completed');
        }

        // Screen 3: Contact & Verification
        function initScreen3() {
            const mobileInput = document.getElementById('mobile');
            const locationInput = document.getElementById('location');
            const otpInput = document.getElementById('otp');
            const sendOtpBtn = document.getElementById('sendOtpBtn');
            const verifyBtn = document.getElementById('verifyBtn');
            const backBtn = document.getElementById('backBtn3');
            
            function checkFields() {
                const mobileValid = mobileInput.value.trim().length >= 10;
                const locationValid = locationInput.value.trim().length >= 3;
                
                // Update form data and profile preview
                if (locationInput.value.trim()) {
                    formData.location = locationInput.value.trim();
                    updateProfilePreview();
                    
                    // Add interactive greeting for location
                    if (locationInput.value.trim().length > 2) {
                        const city = locationInput.value.trim().split(',')[0]; // Get city part
                        addChatMessage(`${city} has a growing business community — love that!`);
                    }
                }
                
                if (sendOtpBtn) {
                    sendOtpBtn.disabled = !(mobileValid && locationValid);
                }
            }
            
            mobileInput.addEventListener('input', checkFields);
            locationInput.addEventListener('input', checkFields);

            sendOtpBtn.addEventListener('click', async () => {
                formData.mobile = mobileInput.value.trim();
                formData.location = locationInput.value.trim();
                
                showLoadingState('loading3', true);
                await new Promise(resolve => setTimeout(resolve, 2000));
                showLoadingState('loading3', false);
                
                const otpGroup = document.getElementById('otpGroup');
                otpGroup.style.display = 'block';
                sendOtpBtn.style.display = 'none';
                verifyBtn.style.display = 'inline-flex';
                otpInput.focus();
            });

            otpInput.addEventListener('input', (e) => {
                if (verifyBtn) {
                    verifyBtn.disabled = e.target.value.length !== 4;
                }
            });

            verifyBtn.addEventListener('click', async () => {
                const otp = otpInput.value.trim();
                if (otp !== '1111') {
                    alert('🚫 Please use 1111 as the OTP for demo mode');
                    return;
                }
                
                showLoadingState('loading4', true);
                formData.otpVerified = true;
                await saveFormData('contact_verified');
                await new Promise(resolve => setTimeout(resolve, 2000));
                showLoadingState('loading4', false);
                showScreen(4);
                generateResults();
            });

            backBtn.addEventListener('click', () => {
                showScreen(2, 'backward');
            });
        }

        // Loading state helper
        function showLoadingState(loadingId, show) {
            const loading = document.getElementById(loadingId);
            if (loading) {
                loading.style.display = show ? 'inline-flex' : 'none';
            }
        }

        // Generate and display results
        async function generateResults() {
            document.getElementById('userName').textContent = formData.fullName;
            
            const story = generatePersonalizedStory();
            document.getElementById('personalizedStory').innerHTML = story;
            
            const score = calculateDigitalReadinessScore();
            setTimeout(() => animateScore(score), 800);
            setTimeout(() => showScoreBreakdown(score), 1200);
            setTimeout(() => showProductRecommendation(), 1600);
            
            await saveFormData('results_generated', { score, story });
        }

        function generatePersonalizedStory() {
            const businessTypeLabels = {
                retail: 'retail business',
                services: 'professional services business', 
                manufacturing: 'manufacturing business',
                others: 'business'
            };

            const statusLabels = {
                no_presence: 'is just getting started with digital',
                basic_social: 'currently uses WhatsApp and Google',
                basic_website: 'has a basic online presence',
                no_results: 'is already online but seeking better results'
            };

            const challengeLabels = {
                no_leads: 'wants to generate more leads',
                dont_know: 'is looking for guidance on where to start',
                no_time: 'needs help managing their digital presence',
                low_sales: 'wants to improve their online sales performance'
            };

            const businessType = answers.businessType || 'business';
            const digitalStatus = answers.digitalStatus || 'exploring digital options';
            const challenge = answers.challenge || 'looking to grow online';
            const budget = answers.budget || 'flexible budget';

            return `
                <strong>${formData.fullName}</strong> runs <strong>${formData.businessName}</strong>, a ${businessTypeLabels[businessType] || 'business'} 
                based in <strong>${formData.location}</strong>. They ${statusLabels[digitalStatus] || 'are exploring digital options'} 
                and ${challengeLabels[challenge] || 'are looking to grow online'} with a monthly budget of <strong>${getBudgetLabel(budget)}</strong>.
            `;
        }

        function calculateDigitalReadinessScore() {
            let score = 0;
            
            const goals = answers.goals || [];
            score += Math.min(Array.isArray(goals) ? goals.length * 5 : 5, 25);
            
            const statusScores = {
                no_presence: 10,
                basic_social: 20,
                basic_website: 25,
                no_results: 30
            };
            score += statusScores[answers.digitalStatus] || 0;
            
            const budgetScores = {
                below_2k: 10,
                '2k_10k': 15,
                '10k_25k': 20,
                '25k_plus': 25
            };
            score += budgetScores[answers.budget] || 0;
            
            const challengeScores = {
                no_leads: 20,
                dont_know: 10,
                no_time: 15,
                low_sales: 18
            };
            score += challengeScores[answers.challenge] || 0;
            
            return Math.min(Math.max(score, 25), 100);
        }

        function animateScore(finalScore) {
            const scoreElement = document.getElementById('scoreNumber');
            const scoreCircle = document.querySelector('.score-circle');
            
            if (!scoreElement) return;
            
            let currentScore = 0;
            const increment = finalScore / 50;
            
            const animation = setInterval(() => {
                currentScore += increment;
                if (currentScore >= finalScore) {
                    currentScore = finalScore;
                    clearInterval(animation);
                }
                scoreElement.textContent = Math.round(currentScore);
            }, 40);
            
            // Add glow effect
            if (scoreCircle) {
                const glowColor = finalScore >= 80 ? 'rgba(16, 185, 129, 0.5)' : 
                                 finalScore >= 60 ? 'rgba(59, 130, 246, 0.5)' : 'rgba(245, 158, 11, 0.5)';
                scoreCircle.style.boxShadow = `0 0 40px ${glowColor}`;
            }
        }

        function showScoreBreakdown(totalScore) {
            const breakdown = document.getElementById('scoreBreakdown');
            if (!breakdown) return;
            
            const dimensions = [
                { label: 'Digital Visibility', score: Math.min(90, totalScore + Math.random() * 20 - 5), icon: '👁️' },
                { label: 'Customer Engagement', score: Math.max(30, totalScore + Math.random() * 30 - 20), icon: '💬' },
                { label: 'Process Automation', score: Math.max(20, totalScore + Math.random() * 40 - 30), icon: '🤖' },
                { label: 'Brand Presence', score: Math.min(95, totalScore + Math.random() * 15), icon: '✨' }
            ];

            breakdown.innerHTML = dimensions.map((dim, index) => {
                const roundedScore = Math.round(dim.score);
                return `
                    <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                        <span style="margin-right: 1rem; font-size: 1.5rem;">${dim.icon}</span>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: white; font-weight: 500;">${dim.label}</span>
                                <span style="color: white; font-weight: 600;">${roundedScore}%</span>
                            </div>
                            <div style="width: 100%; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; overflow: hidden;">
                                <div style="height: 100%; background: linear-gradient(135deg, #667eea, #764ba2); width: ${roundedScore}%; border-radius: 5px; transition: width 1.5s ease-out;"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showProductRecommendation() {
            const container = document.getElementById('recommendedProduct');
            if (!container) return;
            
            const { goals, budget, digitalStatus } = answers;
            let recommendedProduct = 'Topiko';
            
            if (budget === 'below_2k' || digitalStatus === 'no_presence') {
                recommendedProduct = 'Disblay';
            } else if (budget === '25k_plus' && goals?.includes('app')) {
                recommendedProduct = 'HEBT';
            } else if (goals?.includes('brand')) {
                recommendedProduct = 'Brandpreneuring + Topiko';
            }

            const productInfo = {
                'Disblay': {
                    icon: '🌱',
                    title: 'Disblay - Perfect Start',
                    description: 'Ideal for businesses just starting their digital journey',
                    features: ['Quick setup in 24 hours', 'Professional website', 'WhatsApp Business integration', 'Basic analytics'],
                    price: 'Starting at ₹1,999/month',
                    highlight: 'Best for beginners'
                },
                'Topiko': {
                    icon: '🚀',
                    title: 'Topiko - Complete Growth',
                    description: 'Comprehensive digital solution for scaling businesses',
                    features: ['Professional website + mobile app', 'Lead management system', 'Digital marketing tools', 'Advanced analytics'],
                    price: 'Starting at ₹8,999/month',
                    highlight: 'Most popular choice'
                },
                'HEBT': {
                    icon: '⚡',
                    title: 'HEBT - Enterprise Power', 
                    description: 'Custom solutions for established businesses',
                    features: ['Custom development', 'Enterprise integrations', 'Dedicated support team', 'Advanced security'],
                    price: 'Starting at ₹25,000/month',
                    highlight: 'Premium solution'
                },
                'Brandpreneuring + Topiko': {
                    icon: '✨',
                    title: 'Brand + Digital Combo',
                    description: 'Complete brand building with digital presence',
                    features: ['Brand strategy & identity', 'Premium website design', 'Marketing campaigns', 'Social media management'],
                    price: 'Starting at ₹15,999/month',
                    highlight: 'Brand focused'
                }
            };

            const product = productInfo[recommendedProduct];
            
            container.innerHTML = `
                <div>
                    <div style="font-size: 4rem; margin-bottom: 1rem;">${product.icon}</div>
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; margin-bottom: 1rem; display: inline-block;">
                        ${product.highlight}
                    </div>
                    <h4 style="color: white; font-size: 1.5rem; margin-bottom: 1rem; font-weight: 600;">
                        ${product.title}
                    </h4>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 1.5rem; line-height: 1.6;">
                        ${product.description}
                    </p>
                    <div style="text-align: left; margin-bottom: 1.5rem;">
                        ${product.features.map(feature => `
                            <div style="display: flex; align-items: flex-start; margin-bottom: 0.8rem;">
                                <span style="color: #10b981; margin-right: 1rem; font-size: 1.2rem;">✓</span>
                                <span style="color: rgba(255,255,255,0.9); line-height: 1.4;">${feature}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px;">
                        <div style="color: white; font-weight: 600; font-size: 1.1rem;">${product.price}</div>
                    </div>
                </div>
            `;
        }

        function getBudgetLabel(budget) {
            const labels = {
                below_2k: 'below ₹2,000',
                '2k_10k': '₹2,000-₹10,000',
                '10k_25k': '₹10,000-₹25,000',
                '25k_plus': '₹25,000+'
            };
            return labels[budget] || 'flexible budget';
        }

        // Save form data to database
        async function saveFormData(phase, additionalData = {}) {
            if (!supabase) return;
            
            try {
                const leadData = {
                    first_name: formData.fullName.split(' ')[0] || '',
                    last_name: formData.fullName.split(' ').slice(1).join(' ') || '',
                    phone: formData.mobile || '',
                    city: formData.location || '',
                    business_name: formData.businessName || '',
                    business_type: answers.businessType || '',
                    
                    answers: {
                        ...answers,
                        ...additionalData
                    },
                    
                    campaign_source: 'digital_readiness',
                    session_id: formData.sessionId,
                    browser_info: formData.browserInfo,
                    lead_status: phase,
                    created_at: formData.startTime,
                    [`${phase}_at`]: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('franchise_leads')
                    .upsert(leadData, { 
                        onConflict: 'session_id',
                        ignoreDuplicates: false 
                    });

                if (error) {
                    console.error('Database save error:', error);
                } else {
                    console.log(`Phase ${phase} saved successfully`);
                }
            } catch (error) {
                console.error('Save operation failed:', error);
            }
        }

        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            if (!initializeSupabase()) {
                console.warn('Digital Readiness: Supabase initialization failed - running offline');
            }
            
            initScreen1();
            updateProgress();
            
            // Add click handlers for screen 2 and 3 initialization
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const target = mutation.target;
                        if (target.classList.contains('active')) {
                            if (target.id === 'screen2') {
                                initScreen2();
                            } else if (target.id === 'screen3') {
                                initScreen3();
                            }
                        }
                    }
                });
            });
            
            document.querySelectorAll('.screen').forEach(screen => {
                observer.observe(screen, { attributes: true });
            });
        });
    </script>
</body>
</html>