<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Readiness Assessment - Mobile Optimized</title>
    <link rel="icon" type="image/png" href="../logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* MOBILE-FIRST RESET - NO SPACING ISSUES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: auto;
            min-height: auto;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #533483 100%);
            color: white;
            overflow-x: hidden;
        }

        /* MOBILE CONTAINER - TIGHT SPACING */
        .mobile-container {
            width: 100%;
            padding: 8px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* MOBILE PROFILE BAR */
        .mobile-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 8px 12px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .profile-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: white;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 2px;
        }

        .profile-status {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* QUESTION CARD - MINIMAL SPACING */
        .question-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex: 1;
        }

        .question-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.3;
        }

        /* OPTIONS */
        .option-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option-card:hover, .option-card.selected {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.1);
        }

        .option-icon {
            font-size: 20px;
            min-width: 24px;
        }

        .option-content {
            flex: 1;
        }

        .option-title {
            font-weight: 600;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 2px;
        }

        .option-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* CHECKBOXES */
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover, .checkbox-item.selected {
            border-color: rgba(102, 126, 234, 0.5);
            background: rgba(102, 126, 234, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            margin: 0;
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        /* FORM INPUTS */
        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 16px;
            color: white;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        /* PROGRESSIVE FORM SECTIONS */
        #businessNameSection,
        #businessTypeSection, 
        #cityLocationSection {
            display: none;
        }
        
        /* NEXT FIELD INDICATOR */
        .next-indicator {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            align-items: center;
            justify-content: center;
            margin: 16px auto;
            cursor: pointer;
            transition: all 0.3s ease;
            transform: scale(0.8);
        }
        
        .next-indicator.show {
            display: flex;
            transform: scale(1);
        }
        
        .next-indicator:hover {
            transform: scale(1.1);
        }
        
        .next-indicator svg {
            width: 16px;
            height: 16px;
            fill: white;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.6);
            background: rgba(255, 255, 255, 0.08);
        }

        /* BUTTON */
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            transition: transform 0.2s ease;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        /* SCREEN MANAGEMENT */
        .screen {
            display: none;
            width: 100%;
            height: auto;
            padding: 0;
            margin: 0;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        /* CHAT MESSAGE */
        .chat-message {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 12px 16px;
            margin-bottom: 16px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        /* PROGRESS BAR */
        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            height: 6px;
            margin: 0 8px 16px 8px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* RESULTS STYLES */
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .score-number {
            font-size: 36px;
            font-weight: 700;
            color: white;
        }

        /* TOPIKO BRAND */
        .topiko-text {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* NAVIGATION BUTTONS */
        .nav-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .nav-buttons .btn {
            margin-top: 0;
        }

        /* HIDE ON LARGER SCREENS */
        @media (min-width: 769px) {
            body::before {
                content: "This mobile-optimized version is designed for mobile devices. Please use the main version on desktop.";
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                z-index: 9999;
            }
            
            .mobile-container {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Mobile Profile Bar -->
        <div class="mobile-profile" id="mobileProfile" style="display: none;">
            <div class="profile-avatar" id="profileAvatar">?</div>
            <div class="profile-info">
                <div class="profile-name" id="profileName">Building your profile...</div>
                <div class="profile-status" id="profileStatus">Answer questions to get started</div>
            </div>
        </div>

        <!-- Screen 1: Welcome & Basic Info -->
        <div id="screen1" class="screen active">
            <div class="question-card">
                <div class="question-title">Welcome! Let's discover your <span class="topiko-text">Digital Readiness</span></div>
                <div class="chat-message" id="chatMessage1">ðŸ‘‹ Hi! I'm your digital consultant. Let's find the perfect solution for your business.</div>
                
                <div class="question-title" style="margin-top: 20px;">What's your full name?</div>
                <input type="text" class="form-input" id="fullName" placeholder="Enter your full name">
                
                <div class="next-indicator" id="nameIndicator" onclick="focusNext('businessName')">
                    <svg viewBox="0 0 24 24">
                        <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                    </svg>
                </div>
                
                <div id="businessNameSection" style="display: none;">
                    <div class="question-title">What's your business name?</div>
                    <input type="text" class="form-input" id="businessName" placeholder="Enter your business name">
                    
                    <div class="next-indicator" id="businessIndicator" onclick="focusNext('businessType')">
                        <svg viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                        </svg>
                    </div>
                </div>
                
                <div id="businessTypeSection" style="display: none;">
                    <div class="question-title">Type of business</div>
                    <select class="form-input" id="businessType" style="height: 48px;">
                        <option value="">Select your business type</option>
                        <option value="retail">Retail Store</option>
                        <option value="restaurant">Restaurant/Food</option>
                        <option value="salon">Salon/Beauty</option>
                        <option value="boutique">Boutique/Fashion</option>
                        <option value="services">Professional Services</option>
                        <option value="healthcare">Healthcare/Medical</option>
                        <option value="education">Education/Training</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="consulting">Consulting</option>
                        <option value="fitness">Fitness/Gym</option>
                        <option value="travel">Travel/Tourism</option>
                        <option value="real_estate">Real Estate</option>
                        <option value="automotive">Automotive</option>
                        <option value="electronics">Electronics/Tech</option>
                        <option value="other">Other</option>
                    </select>
                    
                    <div class="next-indicator" id="typeIndicator" onclick="focusNext('cityLocation')">
                        <svg viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                        </svg>
                    </div>
                </div>
                
                <div id="cityLocationSection" style="display: none;">
                    <div class="question-title">City/Location</div>
                    <input type="text" class="form-input" id="cityLocation" placeholder="Enter your city">
                    
                    <div class="next-indicator" id="cityIndicator" onclick="showStartButton()">
                        <svg viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                        </svg>
                    </div>
                </div>
                
                <button class="btn" id="continueBtn" style="display: none;">Start Assessment</button>
            </div>
        </div>

        <!-- Screen 2: Business Assessment -->
        <div id="screen2" class="screen">
            <div class="chat-message" id="chatMessage2">Great! Now let's understand your business better.</div>
            
            <div class="question-card">
                <div class="question-title" id="currentQuestion">What type of business do you run?</div>
                <div id="questionContent">
                    <!-- Dynamic content will be inserted here -->
                </div>
                
                <div class="nav-buttons">
                    <button class="btn btn-secondary" id="backBtn" onclick="previousQuestion()">Back</button>
                    <button class="btn" id="nextBtn" disabled onclick="nextQuestion()">Next</button>
                </div>
            </div>
        </div>

        <!-- Screen 3: Contact & Verification -->
        <div id="screen3" class="screen">
            <div class="chat-message" id="chatMessage3">Almost there! We need your mobile number to share your personalized recommendations.</div>
            
            <div class="question-card">
                <div class="question-title">Contact Information</div>
                
                <div class="question-title" style="margin-top: 20px; font-size: 16px;">Mobile Number *</div>
                <input type="tel" class="form-input" id="mobileNumber" placeholder="Enter 10-digit mobile number" maxlength="10">
                
                <div id="otpSection" style="display: none;">
                    <div class="question-title" style="margin-top: 20px; font-size: 16px;">Verification Code</div>
                    <input type="text" class="form-input" id="otpInput" placeholder="Enter 4-digit code" maxlength="4">
                    <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 8px;">
                        Demo: Use 1111 as verification code
                    </div>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="showScreen(2)">Back</button>
                    <button class="btn" id="otpBtn" disabled onclick="handleOTP()">Send OTP</button>
                </div>
            </div>
        </div>

        <!-- Screen 4: Results -->
        <div id="screen4" class="screen">
            <div class="chat-message" id="chatMessage4">ðŸŽ‰ Congratulations! Your personalized digital strategy is ready.</div>
            
            <div class="question-card">
                <div class="question-title" style="text-align: center;">Your Digital Readiness Score</div>
                
                <div class="score-circle">
                    <div class="score-number" id="finalScore">85</div>
                </div>
                
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;" id="scoreTitle">Excellent Digital Potential!</div>
                    <div style="font-size: 14px; color: rgba(255, 255, 255, 0.7);" id="scoreDescription">You're ready for serious digital transformation.</div>
                </div>
                
                <div id="recommendationContent">
                    <!-- Personalized recommendations will be inserted here -->
                </div>
                
                <div class="nav-buttons">
                    <button class="btn" onclick="alert('Thank you! Our team will contact you within 24 hours.')">Get My Detailed Plan</button>
                    <button class="btn btn-secondary" onclick="alert('Booking consultation...')">Book Free Consultation</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-redirect desktop users to main version
        function checkDevice() {
            if (window.innerWidth > 768) {
                window.location.href = '../digitalreadiness/';
                return false;
            }
            return true;
        }
        
        // Check on load and resize
        if (checkDevice()) {
            window.addEventListener('resize', checkDevice);
        }
        
        let currentScreen = 1;
        let currentQuestionIndex = 0;
        let inputTimeout;
        let formData = {
            fullName: '',
            businessName: '',
            businessType: '',
            cityLocation: '',
            goals: [],
            digitalStatus: '',
            budget: '',
            challenge: '',
            mobileNumber: '',
            otpVerified: false
        };

        // Assessment questions for Screen 2
        const questions = [
            {
                id: 'goals',
                question: 'What are your main goals? (Select all that apply)',
                type: 'checkbox',
                options: [
                    { value: 'get_customers', label: 'Get more customers' },
                    { value: 'showcase_products', label: 'Showcase products/services' },
                    { value: 'build_brand', label: 'Build brand identity' },
                    { value: 'create_website', label: 'Create website/app' },
                    { value: 'custom_solution', label: 'Need custom solution' }
                ]
            },
            {
                id: 'digitalStatus',
                question: 'What\'s your current digital presence?',
                type: 'radio',
                options: [
                    { value: 'none', label: 'No digital presence', icon: 'ðŸŒ±' },
                    { value: 'whatsapp_only', label: 'Only WhatsApp/Google', icon: 'ðŸ’¬' },
                    { value: 'basic_website', label: 'Basic website', icon: 'ðŸŒ' },
                    { value: 'active_no_results', label: 'Active but no results', icon: 'ðŸ“‰' }
                ]
            },
            {
                id: 'budget',
                question: 'What\'s your monthly digital budget?',
                type: 'radio',
                options: [
                    { value: 'below_2k', label: 'Below â‚¹2,000', icon: 'ðŸ’°' },
                    { value: '2k_10k', label: 'â‚¹2,000 - â‚¹10,000', icon: 'ðŸ’³' },
                    { value: '10k_25k', label: 'â‚¹10,000 - â‚¹25,000', icon: 'ðŸ’Ž' },
                    { value: '25k_plus', label: 'â‚¹25,000+', icon: 'ðŸš€' }
                ]
            },
            {
                id: 'challenge',
                question: 'What\'s your biggest challenge?',
                type: 'radio',
                options: [
                    { value: 'not_getting_leads', label: 'Not getting leads', icon: 'ðŸ“¢' },
                    { value: 'low_sales', label: 'Low sales despite being online', icon: 'ðŸ“‰' },
                    { value: 'dont_know_start', label: 'Don\'t know where to start', icon: 'â“' },
                    { value: 'no_time', label: 'No time to manage', icon: 'â°' }
                ]
            },
            {
                id: 'timeline',
                question: 'How soon are you looking for a solution?',
                type: 'radio',
                options: [
                    { value: 'immediate', label: 'Immediately', icon: 'âš¡' },
                    { value: '1_3_months', label: '1-3 months', icon: 'ðŸ“…' },
                    { value: '3_6_months', label: '3-6 months', icon: 'ðŸ—“ï¸' },
                    { value: 'exploring', label: 'Just exploring', icon: 'ðŸ”' }
                ]
            },
            {
                id: 'brandHelp',
                question: 'Do you need help with branding?',
                type: 'radio',
                options: [
                    { value: 'yes', label: 'Yes, need logo/branding', icon: 'ðŸŽ¨' },
                    { value: 'improve', label: 'Want to improve existing', icon: 'âœ¨' },
                    { value: 'no', label: 'Happy with current branding', icon: 'âœ…' }
                ]
            }
        ];

        // Initialize event listeners when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Screen 1 inputs
            document.getElementById('fullName').addEventListener('input', handleNameInput);
            document.getElementById('businessName').addEventListener('input', handleBusinessNameInput);
            document.getElementById('businessType').addEventListener('change', handleBusinessTypeChange);
            document.getElementById('cityLocation').addEventListener('input', handleCityInput);
            document.getElementById('continueBtn').addEventListener('click', () => showScreen(2));
            
            // Screen 3 inputs
            document.getElementById('mobileNumber').addEventListener('input', handleContactInput);
            document.getElementById('otpInput').addEventListener('input', handleOTPInput);
            
            // Initialize first question
            loadQuestion(0);
            updateProgress();
        });

        function handleNameInput() {
            const fullName = document.getElementById('fullName').value.trim();
            formData.fullName = fullName;
            
            // Clear previous timeout
            clearTimeout(inputTimeout);
            
            if (fullName.length > 2) {
                // Show business name section first, then show indicator
                document.getElementById('businessNameSection').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('nameIndicator').classList.add('show');
                }, 100);
                updateProfile();
                
                // Debounced chat message update
                inputTimeout = setTimeout(() => {
                    const firstName = fullName.split(' ')[0];
                    const greetings = [
                        `Nice to meet you, ${firstName}! What's your business called?`,
                        `Welcome ${firstName}! Tell me about your business.`,
                        `Hello ${firstName}! Let's learn about your venture.`,
                        `Great to have you here, ${firstName}! What's your business name?`
                    ];
                    const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];
                    document.getElementById('chatMessage1').textContent = randomGreeting;
                }, 1500);
            } else {
                // Hide indicator and subsequent sections
                document.getElementById('nameIndicator').classList.remove('show');
                hideAllSections();
            }
            
            validateScreen1();
        }
        
        function focusNext(fieldId) {
            const field = document.getElementById(fieldId);
            const section = field.closest('div[id$="Section"]');
            
            if (section) {
                section.style.display = 'block';
                setTimeout(() => {
                    field.focus();
                    // Scroll to the new field to ensure it's visible
                    field.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }
        
        function showStartButton() {
            // Hide the final arrow indicator when showing start button
            document.getElementById('cityIndicator').classList.remove('show');
            document.getElementById('continueBtn').style.display = 'block';
            setTimeout(() => {
                document.getElementById('continueBtn').style.opacity = '1';
            }, 100);
        }
        
        function hideAllSections() {
            document.getElementById('businessNameSection').style.display = 'none';
            document.getElementById('businessTypeSection').style.display = 'none';
            document.getElementById('cityLocationSection').style.display = 'none';
            document.getElementById('continueBtn').style.display = 'none';
            
            // Hide all indicators
            document.querySelectorAll('.next-indicator').forEach(indicator => {
                indicator.classList.remove('show');
            });
        }

        function handleBusinessNameInput() {
            const businessName = document.getElementById('businessName').value.trim();
            formData.businessName = businessName;
            
            // Clear previous timeout
            clearTimeout(inputTimeout);
            
            if (businessName.length > 1) {
                // Hide previous indicator, show business type section, then show next indicator
                document.getElementById('nameIndicator').classList.remove('show');
                document.getElementById('businessTypeSection').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('businessIndicator').classList.add('show');
                }, 100);
                updateProfile();
                
                // Debounced chat message update
                inputTimeout = setTimeout(() => {
                    const compliments = [
                        `${businessName} - sounds promising! What type of business is it?`,
                        `${businessName} - I like it! Tell me what industry you're in.`,
                        `${businessName} - excellent choice! What category best describes it?`,
                        `${businessName} - that's a solid name! What's your business type?`,
                        `${businessName} - love the branding potential! What industry are you in?`
                    ];
                    const randomCompliment = compliments[Math.floor(Math.random() * compliments.length)];
                    document.getElementById('chatMessage1').textContent = randomCompliment;
                }, 1500);
            } else {
                // Hide indicator and subsequent sections
                document.getElementById('businessIndicator').classList.remove('show');
                document.getElementById('businessTypeSection').style.display = 'none';
                document.getElementById('cityLocationSection').style.display = 'none';
                document.getElementById('continueBtn').style.display = 'none';
                document.getElementById('typeIndicator').classList.remove('show');
                document.getElementById('cityIndicator').classList.remove('show');
            }
            
            validateScreen1();
        }

        function handleBusinessTypeChange() {
            const businessType = document.getElementById('businessType').value;
            formData.businessType = businessType;
            
            if (businessType) {
                // Hide previous indicator, show city section, then show next indicator
                document.getElementById('businessIndicator').classList.remove('show');
                document.getElementById('cityLocationSection').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('typeIndicator').classList.add('show');
                }, 100);
                
                const typeMessages = {
                    retail: "Retail stores are perfect for digital transformation! Where are you located?",
                    restaurant: "Food businesses are booming online! ðŸ• What's your city?",
                    salon: "Beauty services see amazing digital growth! âœ¨ Where's your salon?",
                    boutique: "Fashion brands love digital marketing! ðŸ‘— What city are you in?",
                    services: "Professional services thrive online! ðŸ’¼ Where do you operate?",
                    healthcare: "Healthcare digitalization is the future! ðŸ¥ What's your location?",
                    education: "EdTech is revolutionizing learning! ðŸ“š Where are you based?",
                    manufacturing: "Industry 4.0 is here! ðŸ­ What city are you in?",
                    consulting: "Consultants scale beautifully online! ðŸ“ˆ Where do you work?",
                    fitness: "Fitness apps and online coaching are huge! ðŸ’ª What's your location?",
                    travel: "Travel booking systems drive great revenue! âœˆï¸ Where are you based?",
                    real_estate: "PropTech is transforming real estate! ðŸ  What city do you serve?",
                    automotive: "Auto services need strong digital presence! ðŸš— Where's your business?",
                    electronics: "Tech businesses must stay cutting-edge! ðŸ’» What's your city?",
                    other: "Every business has digital potential! ðŸš€ Where are you located?"
                };
                
                setTimeout(() => {
                    document.getElementById('chatMessage1').textContent = typeMessages[businessType] || "Great choice! Where are you located?";
                }, 500);
                
                updateProfile();
            } else {
                // Hide indicator and city section
                document.getElementById('typeIndicator').classList.remove('show');
                document.getElementById('cityLocationSection').style.display = 'none';
                document.getElementById('continueBtn').style.display = 'none';
                document.getElementById('cityIndicator').classList.remove('show');
            }
            
            validateScreen1();
        }

        function handleCityInput() {
            const city = document.getElementById('cityLocation').value.trim();
            formData.cityLocation = city;
            
            // Clear previous timeout
            clearTimeout(inputTimeout);
            
            if (city.length > 2) {
                // Hide previous indicator and show final indicator at bottom
                document.getElementById('typeIndicator').classList.remove('show');
                setTimeout(() => {
                    document.getElementById('cityIndicator').classList.add('show');
                }, 100);
                updateProfile();
                
                // Debounced chat message update with completion message
                inputTimeout = setTimeout(() => {
                    const cityMessages = [
                        `${city} has great business potential! ðŸŒŸ Ready to start your assessment?`,
                        `${city} is perfect for digital growth! ðŸ“ Let's build your strategy!`,
                        `Love ${city}! Great market for your business! ðŸŽ¯ Shall we begin?`,
                        `${city} - excellent location for expansion! ðŸš€ Time to assess your digital readiness!`
                    ];
                    const randomCityMessage = cityMessages[Math.floor(Math.random() * cityMessages.length)];
                    document.getElementById('chatMessage1').textContent = randomCityMessage;
                }, 1500);
            } else {
                // Hide final indicator and button
                document.getElementById('cityIndicator').classList.remove('show');
                document.getElementById('continueBtn').style.display = 'none';
            }
            
            validateScreen1();
        }

        function validateScreen1() {
            const continueBtn = document.getElementById('continueBtn');
            const isValid = formData.fullName.length > 2 && 
                           formData.businessName.length > 1 && 
                           formData.businessType && 
                           formData.cityLocation.length > 2;
            continueBtn.disabled = !isValid;
        }

        function updateProfile() {
            const profile = document.getElementById('mobileProfile');
            const avatar = document.getElementById('profileAvatar');
            const name = document.getElementById('profileName');
            const status = document.getElementById('profileStatus');
            
            if (formData.fullName) {
                profile.style.display = 'flex';
                avatar.textContent = formData.fullName.charAt(0).toUpperCase();
                
                const firstName = formData.fullName.split(' ')[0];
                if (formData.businessName) {
                    name.textContent = `${firstName} - ${formData.businessName}`;
                } else {
                    name.textContent = firstName;
                }
                
                // Update status based on current screen
                const statusMessages = {
                    1: 'Getting started...',
                    2: 'Assessment in progress...',
                    3: 'Almost complete!',
                    4: 'Assessment complete!'
                };
                status.textContent = statusMessages[currentScreen] || 'Building profile...';
            }
        }

        function showScreen(screenNumber) {
            // Hide current screen
            document.getElementById(`screen${currentScreen}`).classList.remove('active');
            
            // Show new screen
            currentScreen = screenNumber;
            document.getElementById(`screen${currentScreen}`).classList.add('active');
            
            // Update progress and profile
            updateProgress();
            updateProfile();
            
            // Screen-specific initialization
            if (screenNumber === 2) {
                loadQuestion(0);
            } else if (screenNumber === 4) {
                generateResults();
            }
        }

        function updateProgress() {
            const progress = ((currentScreen - 1) / 3) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        // Question management for Screen 2
        function loadQuestion(index) {
            if (index >= questions.length) {
                showScreen(3);
                return;
            }
            
            currentQuestionIndex = index;
            const question = questions[index];
            
            document.getElementById('currentQuestion').textContent = question.question;
            
            let html = '';
            
            if (question.type === 'radio') {
                question.options.forEach(option => {
                    const selected = formData[question.id] === option.value ? 'selected' : '';
                    html += `
                        <div class="option-card ${selected}" data-question="${question.id}" data-value="${option.value}">
                            ${option.icon ? `<div class="option-icon">${option.icon}</div>` : ''}
                            <div class="option-content">
                                <div class="option-title">${option.label}</div>
                                ${option.subtitle ? `<div class="option-subtitle">${option.subtitle}</div>` : ''}
                            </div>
                        </div>
                    `;
                });
            } else if (question.type === 'checkbox') {
                question.options.forEach(option => {
                    const checked = formData[question.id].includes(option.value) ? 'checked' : '';
                    html += `
                        <label class="checkbox-item">
                            <input type="checkbox" value="${option.value}" ${checked} data-question="${question.id}">
                            <span>${option.label}</span>
                        </label>
                    `;
                });
            }
            
            document.getElementById('questionContent').innerHTML = html;
            
            // Add event listeners for new content
            document.querySelectorAll('.option-card').forEach(card => {
                card.addEventListener('click', handleOptionSelect);
            });
            
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', handleCheckboxChange);
            });
            
            // Update navigation
            document.getElementById('backBtn').style.display = index > 0 ? 'inline-block' : 'none';
            validateCurrentQuestion();
        }

        function handleOptionSelect(e) {
            const card = e.currentTarget;
            const questionId = card.dataset.question;
            const value = card.dataset.value;
            
            // Remove previous selections for this question
            document.querySelectorAll(`[data-question="${questionId}"]`).forEach(c => {
                c.classList.remove('selected');
            });
            
            // Select current option
            card.classList.add('selected');
            formData[questionId] = value;
            
            // Update chat message based on selection
            updateChatMessage(questionId, value);
            
            validateCurrentQuestion();
        }

        function handleCheckboxChange(e) {
            const checkbox = e.target;
            const questionId = checkbox.dataset.question;
            const value = checkbox.value;
            
            if (!Array.isArray(formData[questionId])) {
                formData[questionId] = [];
            }
            
            if (checkbox.checked) {
                if (!formData[questionId].includes(value)) {
                    formData[questionId].push(value);
                }
            } else {
                formData[questionId] = formData[questionId].filter(v => v !== value);
            }
            
            // Add engaging messages for goals selection
            if (questionId === 'goals') {
                const goalMessages = {
                    get_customers: ["More customers = more revenue! ðŸ’°", "Customer acquisition is key to growth! ðŸŽ¯", "Let's build that customer pipeline! ðŸš€"],
                    showcase_products: ["Visual storytelling sells! ðŸ“¸", "Show off your amazing work! âœ¨", "Professional showcase drives trust! ðŸŒŸ"],
                    build_brand: ["Brand identity creates lasting value! ðŸŽ¨", "Strong branding = premium pricing! ðŸ’Ž", "Your brand is your business asset! ðŸ†"],
                    create_website: ["Your 24/7 digital storefront! ðŸª", "Websites that work while you sleep! ðŸ’¤", "Your digital headquarters! ðŸ¢"],
                    custom_solution: ["Custom solutions drive real results! ðŸŽ¯", "Tailored approach for unique needs! âš¡", "Bespoke systems that scale! ðŸš€"]
                };
                
                if (checkbox.checked && goalMessages[value]) {
                    const messages = goalMessages[value];
                    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                    document.getElementById('chatMessage2').textContent = randomMessage;
                }
                
                // Update based on total selected goals
                const totalGoals = formData.goals.length;
                if (totalGoals === 1) {
                    setTimeout(() => {
                        document.getElementById('chatMessage2').textContent = "Great start! Any other goals? The more I know, the better I can help! ðŸ˜Š";
                    }, 2000);
                } else if (totalGoals === 2) {
                    setTimeout(() => {
                        document.getElementById('chatMessage2').textContent = "Perfect! I'm getting a clear picture of your needs. Keep going! ðŸ“ˆ";
                    }, 2000);
                } else if (totalGoals >= 3) {
                    setTimeout(() => {
                        document.getElementById('chatMessage2').textContent = "Wow! You're thinking big! I love ambitious entrepreneurs! ðŸš€â­";
                    }, 2000);
                }
            }
            
            validateCurrentQuestion();
        }

        function updateChatMessage(questionId, value) {
            const messages = {
                digitalStatus: {
                    none: "Perfect blank canvas! We'll build something amazing.",
                    whatsapp_only: "Smart start! Let's expand your reach.",
                    basic_website: "Good foundation! Time to optimize it.",
                    active_no_results: "Let's diagnose and fix that!"
                },
                budget: {
                    below_2k: "Smart budgeting! We'll maximize every rupee.",
                    '2k_10k': "Perfect range for serious growth!",
                    '10k_25k': "Ready for scale! Let's optimize.",
                    '25k_plus': "Enterprise level! Custom solutions await."
                },
                challenge: {
                    not_getting_leads: "We'll fix your lead pipeline!",
                    low_sales: "Time to convert that traffic and boost sales!",
                    dont_know_start: "That's why I'm here! We'll guide you step-by-step.",
                    no_time: "We'll handle everything for you!"
                },
                timeline: {
                    immediate: "Urgent needs require smart solutions! âš¡",
                    '1_3_months': "Perfect timeline for solid growth! ðŸ“ˆ",
                    '3_6_months': "Strategic planning pays off! ðŸŽ¯",
                    exploring: "Smart to explore options first! ðŸ”"
                },
                brandHelp: {
                    yes: "Great branding is a game-changer! ðŸŽ¨",
                    improve: "Brand evolution keeps you competitive! âœ¨",
                    no: "Strong existing brand is an asset! âœ…"
                }
            };
            
            if (messages[questionId] && messages[questionId][value]) {
                document.getElementById('chatMessage2').textContent = messages[questionId][value];
            }
        }

        function validateCurrentQuestion() {
            const question = questions[currentQuestionIndex];
            const nextBtn = document.getElementById('nextBtn');
            let isValid = false;
            
            if (question.type === 'radio') {
                isValid = !!formData[question.id];
            } else if (question.type === 'checkbox') {
                isValid = formData[question.id] && formData[question.id].length > 0;
            }
            
            nextBtn.disabled = !isValid;
        }

        function nextQuestion() {
            loadQuestion(currentQuestionIndex + 1);
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                loadQuestion(currentQuestionIndex - 1);
            } else {
                showScreen(1);
            }
        }

        // Screen 3 Contact handling
        function handleContactInput() {
            const mobile = document.getElementById('mobileNumber').value.trim();
            
            formData.mobileNumber = mobile;
            
            const otpBtn = document.getElementById('otpBtn');
            const isValid = mobile.length === 10 && /^\d+$/.test(mobile);
            
            otpBtn.disabled = !isValid;
            
            if (isValid && !formData.otpSent) {
                otpBtn.textContent = 'Send OTP';
            }
        }

        function handleOTP() {
            if (!formData.otpSent) {
                // Send OTP
                document.getElementById('otpSection').style.display = 'block';
                document.getElementById('otpBtn').textContent = 'View My Results';
                document.getElementById('otpBtn').disabled = true;
                formData.otpSent = true;
                
                // Update chat
                document.getElementById('chatMessage3').textContent = 'Verification code sent! Enter 1111 to continue.';
            } else if (formData.otpVerified) {
                // Show results
                showScreen(4);
            }
        }

        function handleOTPInput() {
            const otp = document.getElementById('otpInput').value.trim();
            const otpBtn = document.getElementById('otpBtn');
            
            if (otp === '1111') {
                formData.otpVerified = true;
                otpBtn.disabled = false;
                document.getElementById('chatMessage3').textContent = 'âœ… Verified! Click to view your results.';
            } else {
                formData.otpVerified = false;
                otpBtn.disabled = true;
            }
        }

        // Topiko Recommendation Engine
        function generateResults() {
            const recommendation = getTopikkoRecommendation(formData);
            
            // Update score display
            document.getElementById('finalScore').textContent = recommendation.confidence;
            
            // Update score description based on confidence
            let title, description;
            if (recommendation.confidence >= 85) {
                title = "Perfect Match Found!";
                description = "High confidence recommendation based on your needs.";
            } else if (recommendation.confidence >= 70) {
                title = "Great Solution Identified!";
                description = "Strong match for your business requirements.";
            } else {
                title = "Good Starting Point!";
                description = "Solid foundation for your digital journey.";
            }
            
            document.getElementById('scoreTitle').textContent = title;
            document.getElementById('scoreDescription').textContent = description;
            
            // Generate recommendations based on engine results
            generateRecommendations(recommendation);
        }
        
        function getTopikkoRecommendation(data) {
            // Products available
            const products = {
                disblay: { name: "Disblay", price: 1499, description: "Starter showcase website" },
                topiko_basic: { name: "Topiko Basic", price: 4999, description: "Professional website + domain" },
                topiko_pro: { name: "Topiko Pro", price: 9999, description: "Full digital presence + CRM" },
                marketing: { name: "Digital Marketing", price: 4999, description: "Lead generation + campaigns" },
                brandpreneuring: { name: "Brandpreneuring", price: 999, description: "Logo + brand identity" },
                hebt: { name: "HEBT Custom", price: 300000, description: "Custom enterprise solution" }
            };
            
            // Hard overrides first
            const overrides = checkHardOverrides(data);
            if (overrides) {
                return {
                    primary_recommendation: {
                        product_id: overrides.product,
                        product_name: products[overrides.product].name,
                        price: products[overrides.product].price,
                        description: products[overrides.product].description,
                        confidence: overrides.confidence,
                        reason: overrides.reason
                    },
                    secondary_recommendations: overrides.secondary || [],
                    route_to: overrides.route,
                    crm_tags: generateCRMTags(data, overrides.product)
                };
            }
            
            // Scoring rules
            const scores = calculateProductScores(data);
            const topProduct = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            const confidence = Math.min(95, Math.max(60, scores[topProduct]));
            
            // Generate secondary recommendations
            const sortedProducts = Object.entries(scores)
                .sort(([,a], [,b]) => b - a)
                .slice(1, 3)
                .filter(([product, score]) => score > 30)
                .map(([product, score]) => ({
                    product_id: product,
                    product_name: products[product].name,
                    price: products[product].price,
                    note: getSecondaryNote(product, topProduct)
                }));
            
            return {
                primary_recommendation: {
                    product_id: topProduct,
                    product_name: products[topProduct].name,
                    price: products[topProduct].price,
                    description: products[topProduct].description,
                    confidence: confidence,
                    reason: generateReason(data, topProduct, scores)
                },
                secondary_recommendations: sortedProducts,
                route_to: getRoutingPath(topProduct, data.budget),
                crm_tags: generateCRMTags(data, topProduct)
            };
        }
        
        function checkHardOverrides(data) {
            // Custom solution override
            if (data.goals && data.goals.includes('custom_solution')) {
                return {
                    product: 'hebt',
                    confidence: 95,
                    reason: 'Custom solution requirement detected',
                    route: 'hebt_pipeline'
                };
            }
            
            // No digital + low budget
            if (data.digitalStatus === 'none' && data.budget === 'below_2k') {
                return {
                    product: 'disblay',
                    confidence: 90,
                    reason: 'Perfect starter solution for new businesses',
                    route: 'self_serve'
                };
            }
            
            // Active but no results + marketing interest
            if (data.digitalStatus === 'active_no_results' && data.goals && data.goals.includes('get_customers')) {
                return {
                    product: 'marketing',
                    confidence: 88,
                    reason: 'Need marketing to drive results from existing presence',
                    route: 'consultative_sales',
                    secondary: [{ product_id: 'topiko_basic', note: 'Foundation upgrade' }]
                };
            }
            
            // Brand help + good budget
            if ((data.brandHelp === 'yes' || data.brandHelp === 'improve') && 
                (data.budget === '10k_25k' || data.budget === '25k_plus')) {
                return {
                    product: 'brandpreneuring',
                    confidence: 85,
                    reason: 'Branding essential for business growth',
                    route: 'consultative_sales',
                    secondary: [{ product_id: 'topiko_pro', note: 'Complete digital presence' }]
                };
            }
            
            // Create website + mid budget
            if (data.goals && data.goals.includes('create_website') && data.budget === '2k_10k') {
                return {
                    product: 'topiko_basic',
                    confidence: 87,
                    reason: 'Perfect budget for professional website',
                    route: 'consultative_sales'
                };
            }
            
            return null;
        }
        
        function calculateProductScores(data) {
            const scores = {
                disblay: 0,
                topiko_basic: 0,
                topiko_pro: 0,
                marketing: 0,
                brandpreneuring: 0,
                hebt: 0
            };
            
            // Goal-based scoring
            if (data.goals) {
                data.goals.forEach(goal => {
                    switch(goal) {
                        case 'showcase_products':
                            scores.disblay += 40;
                            scores.topiko_basic += 20;
                            break;
                        case 'get_customers':
                            scores.marketing += 30;
                            scores.topiko_pro += 25;
                            break;
                        case 'build_brand':
                            scores.brandpreneuring += 40;
                            scores.topiko_basic += 20;
                            break;
                        case 'create_website':
                            scores.topiko_basic += 35;
                            scores.disblay += 15;
                            break;
                        case 'custom_solution':
                            scores.hebt += 100;
                            break;
                    }
                });
            }
            
            // Digital status scoring
            switch(data.digitalStatus) {
                case 'none':
                    if (data.budget === 'below_2k') scores.disblay += 60;
                    else if (data.budget === '2k_10k') scores.topiko_basic += 60;
                    break;
                case 'whatsapp_only':
                    scores.disblay += 50;
                    scores.topiko_basic += 20;
                    break;
                case 'active_no_results':
                    scores.marketing += 50;
                    scores.topiko_pro += 30;
                    break;
            }
            
            // Challenge-based scoring
            switch(data.challenge) {
                case 'not_getting_leads':
                    scores.marketing += 40;
                    scores.topiko_pro += 20;
                    break;
                case 'low_sales':
                    scores.brandpreneuring += 40;
                    scores.marketing += 30;
                    break;
            }
            
            // Brand help scoring
            if (data.brandHelp === 'yes' || data.brandHelp === 'improve') {
                scores.brandpreneuring += 40;
                scores.topiko_basic += 20;
            }
            
            // Budget modifiers
            if (data.budget === '25k_plus') {
                scores.hebt += 50;
            }
            
            // Timeline modifiers
            if (data.timeline === 'immediate' && data.budget === '2k_10k') {
                scores.topiko_basic += 30;
                scores.marketing += 20;
            }
            
            return scores;
        }
        
        function generateReason(data, topProduct, scores) {
            const reasons = {
                disblay: `Perfect starter solution for showcasing ${data.businessType} business`,
                topiko_basic: `Professional website ideal for ${data.businessType} with your budget`,
                topiko_pro: `Complete digital presence to grow your ${data.businessType} business`,
                marketing: `Lead generation essential for customer acquisition goals`,
                brandpreneuring: `Strong branding foundation for business growth`,
                hebt: `Custom solution for unique business requirements`
            };
            
            return reasons[topProduct] || `Best match based on your requirements`;
        }
        
        function getSecondaryNote(product, primary) {
            const notes = {
                disblay: "Great starting point",
                topiko_basic: "Professional foundation",
                topiko_pro: "Complete solution",
                marketing: "Drive more leads", 
                brandpreneuring: "Build strong brand",
                hebt: "Custom development"
            };
            return notes[product] || "Recommended addition";
        }
        
        function getRoutingPath(product, budget) {
            if (product === 'hebt') return 'hebt_pipeline';
            if (product === 'disblay' && budget === 'below_2k') return 'self_serve';
            return 'consultative_sales';
        }
        
        function generateCRMTags(data, product) {
            const tags = [
                `${product}_lead`,
                `budget_${data.budget}`,
                `digital_${data.digitalStatus}`,
                `${data.businessType}_business`
            ];
            
            if (data.timeline === 'immediate') tags.push('urgent_timeline');
            if (data.goals && data.goals.includes('get_customers')) tags.push('wants_customers');
            if (data.brandHelp === 'yes') tags.push('needs_branding');
            
            return tags;
        }

        function generateRecommendations(recommendation) {
            const firstName = formData.fullName.split(' ')[0];
            const primary = recommendation.primary_recommendation;
            
            let recommendations = `
                <div style="text-align: left; margin-bottom: 20px;">
                    <div style="font-size: 18px; font-weight: 700; margin-bottom: 8px; color: #667eea;">
                        ðŸ’Ž ${primary.product_name}
                    </div>
                    <div style="font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 12px;">
                        ${primary.description}
                    </div>
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 12px;">
                        â‚¹${primary.price.toLocaleString()}${primary.price < 10000 ? '/year' : primary.price > 100000 ? ' starting' : '/year'}
                    </div>
                    <div style="font-size: 13px; color: rgba(255,255,255,0.7); margin-bottom: 16px; font-style: italic;">
                        "${primary.reason}"
                    </div>
            `;
            
            // Add secondary recommendations if available
            if (recommendation.secondary_recommendations && recommendation.secondary_recommendations.length > 0) {
                recommendations += '<div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Also Consider:</div>';
                recommendation.secondary_recommendations.forEach(sec => {
                    recommendations += `
                        <div style="background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-weight: 600; font-size: 14px;">${sec.product_name}</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.7);">${sec.note} - â‚¹${sec.price.toLocaleString()}</div>
                        </div>
                    `;
                });
            }
            
            // Add routing information for internal use (hidden)
            recommendations += `
                </div>
                <div style="display: none;" id="recommendationData">
                    ${JSON.stringify({
                        primary: primary,
                        secondary: recommendation.secondary_recommendations,
                        route: recommendation.route_to,
                        tags: recommendation.crm_tags,
                        confidence: primary.confidence
                    })}
                </div>
            `;
            
            document.getElementById('recommendationContent').innerHTML = recommendations;
            
            // Update final chat message with confidence-based messaging
            let chatMessage;
            if (primary.confidence >= 85) {
                chatMessage = `ðŸŽ¯ ${firstName}, I'm highly confident this is perfect for ${formData.businessName}! ${primary.product_name} matches your needs exactly.`;
            } else if (primary.confidence >= 70) {
                chatMessage = `ðŸŽ‰ ${firstName}, great news! ${primary.product_name} is an excellent fit for ${formData.businessName}'s goals.`;
            } else {
                chatMessage = `ðŸš€ ${firstName}, ${primary.product_name} is a solid starting point for ${formData.businessName}'s digital journey!`;
            }
            
            document.getElementById('chatMessage4').textContent = chatMessage;
        }
    </script>
</body>
</html>